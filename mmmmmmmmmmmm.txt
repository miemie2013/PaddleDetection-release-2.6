## 快速开始


pip install sklearn pandas -i https://pypi.tuna.tsinghua.edu.cn/simple



### 训练

# 单卡
python tools/train.py -c configs/ppyoloe/distill/ppyoloe_plus_crn_l_80e_coco_distill.yml --slim_config configs/slim/distill/ppyoloe_plus_distill_x_distill_l.yml


# 多卡
python -m paddle.distributed.launch --log_dir=ppyoloe_plus_distill_x_distill_l/ --gpus 0,1,2,3,4,5,6,7 tools/train.py -c configs/ppyoloe/distill/ppyoloe_plus_crn_l_80e_coco_distill.yml --slim_config configs/slim/distill/ppyoloe_plus_distill_x_distill_l.yml




- `-c`: 指定模型配置文件，也是student配置文件。
- `--slim_config`: 指定压缩策略配置文件，也是teacher配置文件。


----------------------- 迁移学习，带上-c（--ckpt）参数读取预训练模型。 -----------------------
读 COCO 预训练模型（实际上由obj365 fine-tune 得到）进行fine-tune：
单卡：
nohup python tools/train.py -c configs/ppyoloe/ppyoloe_plus_crn_s_16e_voc2012.yml --eval     > ppyoloe_plus_s_from_coco.log 2>&1 &

实测 ppyoloe_plus_s_from_coco 的AP(0.50:0.95)可以到达0.62+、AP(0.50)可以到达0.81+、AP(small)可以到达0.22+。
日志见 train_ppyolo_in_voc2012/ppyoloe_plus_s_from_coco.log



- - - - - - -
双卡（暂时不要折腾多卡）：
docs/tutorials/DistributedTraining_cn.md

export CUDA_VISIBLE_DEVICES=0,1

fleetrun --selected_gpu 8,9 tools/train.py -c configs/ppyoloe/ppyoloe_plus_crn_s_16e_voc2012.yml --eval    &>ppyoloe_plus_s_from_coco.txt 2>&1 &

nohup python -m paddle.distributed.launch --gpus 8,9 tools/train.py -c configs/ppyoloe/ppyoloe_plus_crn_s_16e_voc2012.yml --eval     > ppyoloe_plus_s_from_coco.log 2>&1 &







----------------------- 知识蒸馏 -----------------------
1.先训练老师模型:
读 COCO 预训练模型（实际上由obj365 fine-tune 得到）进行fine-tune：
python tools/train.py -c configs/ppyoloe/ppyoloe_plus_crn_l_16e_voc2012.yml --eval


nohup python tools/train.py -c configs/ppyoloe/ppyoloe_plus_crn_l_16e_voc2012.yml --eval     > ppyoloe_plus_l_from_coco.log 2>&1 &




实测 ppyoloe_plus_l_from_coco 的AP(0.50:0.95)可以到达0.715+、AP(0.50)可以到达0.881+、AP(small)可以到达0.314+。
日志见 train_ppyolo_in_voc2012/ppyoloe_plus_l_from_coco.log



2.蒸馏:
读 COCO 预训练模型（实际上由obj365 fine-tune 得到）进行fine-tune：
export CUDA_VISIBLE_DEVICES=0,1
nohup python tools/train.py -f exps/ppyoloe_plus/ppyoloe_plus_crn_s_voc2012.py -d 2 -b 16 -eb 8 -w 4 -ew 4 -lrs 1.0 -c ppyoloe_plus_crn_s_80e_coco.pth -sf exps/slim/distill/ppyoloe_plus_crn_l_voc2012_l2s.py -sc PPYOLOEPlus_outputs/ppyoloe_plus_crn_l_voc2012/16.pth     > ppyoloe_plus_s_from_coco.log 2>&1 &

恢复训练:
nohup python tools/train.py -f exps/ppyoloe_plus/ppyoloe_plus_crn_s_voc2012.py -d 2 -b 16 -eb 8 -w 4 -ew 4 -lrs 1.0 -c 7.pth --resume -sf exps/slim/distill/ppyoloe_plus_crn_l_voc2012_l2s.py -sc PPYOLOEPlus_outputs/ppyoloe_plus_crn_l_voc2012/16.pth     > ppyoloe_plus_s_from_coco.log 2>&1 &


(单卡调试)
python tools/train.py -f exps/ppyoloe_plus/ppyoloe_plus_crn_s_voc2012.py -d 1 -b 4 -eb 4 -w 1 -ew 1 -lrs 1.0 -c ppyoloe_plus_crn_s_80e_coco.pth -sf exps/slim/distill/ppyoloe_plus_crn_l_voc2012_l2s.py -sc PPYOLOEPlus_outputs/ppyoloe_plus_crn_l_voc2012/16.pth


实测 ppyoloe_plus_s_from_coco 的AP(0.50:0.95)可以到达0.xxx+、AP(0.50)可以到达0.xxx+、AP(small)可以到达0.xxx+。
日志见 train_ppyolo_in_voc2012/ppyoloe_plus_s_distill_l2s.txt
